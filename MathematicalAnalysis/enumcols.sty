%%
%% This is file `enumcols.sty',
%% generated with the docstrip utility.
%%
%% The original source files were:
%%
%% enumcols.dtx  (with options: `package')
%%
%% This is a generated file.
%%
%% Copyright (C) 2011 by Qing Lee <sobenlee@gmail.com>
%% --------------------------------------------------------------------------
%% This work may be distributed and/or modified under the
%% conditions of the LaTeX Project Public License, either version 1.3
%% of this license or (at your option) any later version.
%% The latest version of this license is in
%%   http://www.latex-project.org/lppl.txt
%% and version 1.3 or later is part of all distributions of LaTeX
%% version 2005/12/01 or later.
%%
\NeedsTeXFormat{LaTeX2e}[1999/12/01]
\ProvidesPackage{enumcols}
    [2011/12/02 v1.0 Produce an enumerated array of multiple columns]
\RequirePackage{kvoptions}
\RequirePackage{etoolbox}
\RequirePackage{varwidth}
\RequirePackage{labelformat}
\RequirePackage{calc}

\SetupKeyvalOptions{family=ecols,prefix=ecols@}

\DeclareBoolOption[true]{top}
\DeclareBoolOption{itemize}
\DeclareBoolOption{hang}
\DeclareBoolOption{adjust}
\DeclareBoolOption{flushleft}
\DeclareStringOption[enum]{counter}
\DeclareStringOption{format}

\def\ECOLS@key{\define@key{ecols}}

\DeclareListParser*{\ecols@forcsvlist}{,}

\def\ecols@for@lengthkey#1{
  \ecols@lengthkey@for#1\@nil
}

\def\ecols@lengthkey@for#1==#2\@nil{
  \csgluedef{ecols@#1@l}{#2}
  \ECOLS@key{#1}{\csgluedef{ecols@#1@l}{##1}}
}

\ecols@forcsvlist{\ecols@for@lengthkey}{
   {parsep==\parskip},
   {labelsep==\labelsep},
   {partopsep==\z@},
   {topsep==\z@},
   {itemsep==\z@},
   {listparindent==\parindent},
   {leftmargin==\z@},
   {leftskip==\z@},
   {itemleftskip==\z@},
   {ecolswidth==\z@},
   {ecolstotalwidth==\linewidth/\tw@},
}

\def\ecols@for@colskey#1{
  \ECOLS@key{#1}[#1]{\numdef\ecols@cols{##1}}
}

\ecols@forcsvlist{\ecols@for@colskey}{
 -1,0,1,2,3,4,5,6,7,8,9,10,
}

\newtoggle{ecols@formatogl}
\newtoggle{ecols@reftogl}

\def\ecols@labelkey#1{%
  \toggletrue{ecols@formatogl}%
  \ifbool{ecols@itemize}
    {\toggletrue{ecols@reftogl}\def\ecols@labelformat{#1}}
    {\ecols@labelkey@#1\@nil}%
}

\def\ecols@labelkey@#1*#2\@nil{%
  \def\ecols@labelformat{#1{\@enumctr}#2}%
}

\def\ecols@refkey#1{%
  \toggletrue{ecols@reftogl}%
  \ecols@refkey@#1\@nil
}

\def\ecols@refkey@#1*#2\@nil{%
  \def\ecols@reformat{%
    \setlabelformat*{\@enumctr}{#1{\@enumctr}#2}}%
}

\ECOLS@key{label}{\ecols@labelkey{#1}}
\ECOLS@key{ref}{\ecols@refkey{#1}}
\ECOLS@key{cols}[\tw@]{\numdef\ecols@cols{#1}}

\ECOLS@key{ecolswidth*}{%
  \numdef\ecols@cols\m@ne
  \dimdef\ecols@ecolswidth@l{#1}%
}

\ECOLS@key{inlist}[true]{%
  \ifbool{#1}{%
    \boolfalse{ecols@top}%
    \dimdef\ecols@leftmargin@l{\z@}%
    \dimdef\ecols@leftskip@l{-\labelsep-\labelwidth}%
  }{}%
}

\ProcessKeyvalOptions*\relax

\newrobustcmd*\setenumcols[1][]{\setkeys{ecols}{#1}}

\newdimen\ecolsleftmargin
\newdimen\ecolswidth
\newdimen\ecolstotalwidth

\newdimen\ecols@labelwidth
\newdimen\ecols@dima
\newdimen\ecols@dimb
\newcount\ecols@curcnt

\newtoggle{ecols@togla}
\newtoggle{ecols@toglb}

\newbool{ecols@boolarg}
\newbool{ecols@hyper@load}

\AtEndPreamble{\@ifpackageloaded{hyperref}{\booltrue{ecols@hyper@load}}{}}

\newenvironment{enumcols}[1][]{%
    \ifnum\@listdepth >\thr@@
      \@toodeep
      \let\@endecols@item\relax
    \else
      \ifx\item\ecols@item@
        \ecols@nesterr
        \let\@endecols@item\relax
      \else
        \setenumcols[itemize=false,#1]%
        \ecolsleftmargin=\ecols@leftmargin@l\relax
        \ifbool{ecols@top}{%
          \advance\@listdepth\@ne
          \ifbool{ecols@itemize}{%
            \ifdefstring{\ecols@counter}{enum}{\def\ecols@counter{item}}{}%
            \edef\@itemitem{label\ecols@counter\romannumeral\the\@listdepth}%
          }{%
            \ifbool{ecols@adjust}{%
              \global\advance\ecols@curcnt\@ne
              \edef\ecols@currlist{ecols@list@\romannumeral\the\ecols@curcnt}%
            }{}%
            \edef\@enumctr{\ecols@counter\romannumeral\the\@listdepth}%
            \ifltxcounter{\@enumctr}{}{\newcounter{\@enumctr}}%
          }%
          \advance\@listdepth\m@ne
        }{\item[]}%
        \list{}{%
          \itemsep      \z@\relax
          \itemindent   \z@\relax
          \listparindent\z@\relax
          \leftmargin   \ecols@leftmargin@l\relax
          \parsep       \ecols@parsep@l\relax
          \partopsep    \ecols@partopsep@l\relax
          \topsep       \ecols@topsep@l\relax
        }%
        \item\relax
        \rightskip\@flushglue
        \iftoggle{ecols@formatogl}{%
            \def\@itemlabel{\ecols@format\ecols@labelformat}%
            \iftoggle{ecols@reftogl}{}
              {\setlabelformat*{\@enumctr}{\ecols@labelformat}}%
        }{%
            \def\@itemlabel{\ecols@format
              \ifbool{ecols@itemize}{\csuse{\@itemitem}}{\csuse{label\@enumctr}}%
            }
        }%
        \ifbool{ecols@itemize}{}
          {\iftoggle{ecols@reftogl}{\ecols@reformat}{}}%
        \settowidth\ecols@labelwidth{\@itemlabel}%
        \ifbool{ecols@itemize}{\@nmbrlistfalse}
            {\@nmbrlisttrue\def\@listctr{\@enumctr}}%
        \ifecols@top
          \ifbool{ecols@itemize}{%
            \boolfalse{ecols@adjust}%
            \boolfalse{ecols@flushleft}%
          }{%
            \setcounter\@enumctr{\@ne}%
          }%
          \ifecols@adjust
            \settowidth\ecols@dima{\@itemlabel}%
            \settowidth\ecols@dimb{\@itemlabel}%
            \ifcsundef{\ecols@currlist}
              {\ecols@labelwidth=\ecols@dimb\relax}
              {\setlength\ecols@labelwidth{\csuse{\ecols@currlist}}%
               \toggletrue{ecols@togla}%
               \advance\ecols@dimb-\ecols@labelwidth}%
          \else
            \settowidth\ecols@labelwidth{\@itemlabel}%
          \fi
            \ifbool{ecols@itemize}{}{\setcounter{\@enumctr}{\z@}}%
        \fi
        \leftskip=\ecols@leftskip@l\relax
        \advance\linewidth-\leftskip\relax
        \advance\linewidth-\ecols@itemleftskip@l\relax
        \ifdimgreater{\ecols@ecolswidth@l}{\z@}{%
          \dimdef\ecols@ecolstotalwidth@l
            {\ecols@ecolswidth@l+\ecols@labelwidth+\ecols@labelsep@l}}{}%
        \ifdef{\ecols@cols}
          {\ifnumgreater{\ecols@cols}{\z@}{%
              \dimdef\ecols@ecolstotalwidth@l{\linewidth/\ecols@cols}%
            }{%
              \ifnumequal{\ecols@cols}{\z@}
                {\dimdef\ecols@ecolstotalwidth@l{\linewidth}}{}%
            }%
          }{}%
        \dimdef\ecols@ecolswidth@l
          {\ecols@ecolstotalwidth@l-\ecols@labelwidth-\ecols@labelsep@l}%
        \ecolswidth=\ecols@ecolswidth@l\relax
        \ecolstotalwidth=\ecols@ecolstotalwidth@l\relax
        \dimdef\ecols@itemsep@l{\ecols@itemsep@l+1em}%
        \def\ecols@itemstrut{\rule\z@{\ecols@itemsep@l}}%
        \let\@endecols@item\noindent
        \let\item\ecols@item@
      \fi
    \fi\ignorespaces
}{%
    \@endecols@item
    \global\booltrue{ecols@top}%
    \global\togglefalse{ecols@togla}%
    \global\togglefalse{ecols@toglb}%
    \endlist
    \ignorespacesafterend
}

\newenvironment{enumcols*}[1][]
  {\enumcols[inlist,#1]}
  {\endenumcols}

\newenvironment{itemcols}[1][]
  {\enumcols[itemize,#1]}
  {\endenumcols}

\newenvironment{itemcols*}[1][]
  {\enumcols[itemize,inlist,#1]}
  {\endenumcols}

\def\ecols@item@{%
  \@endecols@item
  \@inmatherr\item
  \@ifnextchar[%]
    {\ecols@item}
    {\@noitemargtrue\booltrue{ecols@boolarg}\ecols@item[\@itemlabel]}%
}

\def\ecols@item[#1]{%
  \def\@endecols@item{%
    \ifbool{ecols@hang}{\endvarwidth}{}%
    \endvarwidth\unskip\ignorespaces\endlrbox\endgroup
    \@tempdima = \wd\@tempboxa\relax
    \@tempdimb = \ecols@ecolstotalwidth@l\relax
    \advance \@tempdima  \m@ne sp\relax
    \divide  \@tempdima  \@tempdimb
    \advance \@tempdima  \@ne  sp\relax
    \multiply\@tempdimb  \@tempdima
    \advance \@tempdimb -\wd\@tempboxa
    \usebox  \@tempboxa
    \hskip   \@tempdimb\relax
  }%
  \if@noitemarg
    \@noitemargfalse
    \ifbool{ecols@hyper@load}{\@hyper@itemfalse}{}%
    \if@nmbrlist
      \ifbool{ecols@hyper@load}{\@hyper@itemtrue}{}%
      \refstepcounter{\@listctr}%
      \ifboolexpr{ bool {ecols@top} and bool {ecols@adjust}}{%
          \setlength\@tempdima{\widthof{#1}}%
          \ifdimless\@tempdima\ecols@labelwidth
            {\global\toggletrue{ecols@toglb}}{}%
          \ifdimless\ecols@dima\@tempdima
            {%
              \global\ecols@dima=\@tempdima\relax
              \protected@write\@auxout{}{%
                \csgdef{\ecols@currlist}{\widthof{#1}}%
              }%
            }{}%
        }{}%
    \fi
  \fi
  \begingroup\lrbox{\@tempboxa}\varwidth[t]{\linewidth}%
  \leftskip\ecols@itemleftskip@l\relax
  \ifbool{ecols@boolarg}
    {%
      \global\boolfalse{ecols@boolarg}%
      \ifbool{ecols@top}
        {%
          \ifbool{ecols@flushleft}
            {%
              \makebox[\ecols@labelwidth][l]{#1\ecols@itemstrut\strut}%
              \ifboolexpr{ bool {ecols@adjust} and togl {ecols@toglb}}
                {%
                  \global\togglefalse{ecols@toglb}%
                  \iftoggle{ecols@togla}{%
                    \dimdef\ecols@labelsep@l{\ecols@labelsep@l+\ecols@dimb}%
                    \advance\ecolswidth-\ecols@dimb\relax}{}%
                }{}%
            }{%
              \ifboolexpr{ bool {ecols@adjust} and togl {ecols@toglb}}
                {%
                  \global\togglefalse{ecols@toglb}%
                  \iftoggle{ecols@togla}{%
                    \advance\ecols@labelwidth\ecols@dimb\relax
                    \advance\ecolswidth-\ecols@dimb\relax}{}%
                }{}%
              \makebox[\ecols@labelwidth][r]{#1\ecols@itemstrut\strut}%
            }%
        }{%
          \mbox{#1\ecols@itemstrut\strut}%
        }%
    }{%
      \ifblank{#1}
        {\dimdef\ecols@labelsep@l\z@\ecols@itemstrut\strut}
        {\mbox{#1\ecols@itemstrut\strut}}%
    }%
  \hskip\dimexpr\ecols@labelsep@l\relax
  \ifbool{ecols@hang}{%
      \varwidth[t]{\dimexpr\linewidth-\ecols@labelwidth-\ecols@labelsep@l\relax}%
      \parindent\ecols@listparindent@l\hskip-\parindent\relax
  }{%
      \parindent\ecols@listparindent@l\hskip-\parindent\relax
  }%
  \ignorespaces
}

\def\ecols@nesterr{\PackageError{enumcols}%
   {nested enumcols-list, don't nest enumcols-list environments within each other.}}

\endinput
%%
%% End of file `enumcols.sty'.
